<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | Webapp</title>
    <style>
      html, 
      body {
          width: 100%;
          height: 100%;
          padding: 0;
          margin: 0;
          color: black;
          position: relative;
      }

      video_player_box, canvas, iframe, video, figure {
        margin: 0;
        position: absolute;
        top: 50%;
        left: 50%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
        width: 100%; 
        height: 100%; 
        background-color: black; 
        max-width: 1120px; 
        max-height: 630px; 
      }
	  
	  #playpausebtn {
		margin: 0;
        position: absolute;
		width: 100%;
		height: 100%;
        top: 50%;
        left: 50%;
        -ms-transform: translate(-50%, -50%);
        transform: translate(-50%, -50%);
	  }

	  /*
	  figcaption {
		position: absolute;
		bottom: -40px;
		align-items: center;
		background: #eaeaea;
		width: 100%;
		max-width: 1120px;
		height: 40px;
		padding: 0;
		margin: 0;
	  }
	  
	  #progress {
		width: 82%;
		max-width: 1120px;
		height: 38px;
		margin: 0;
		padding: 0;
	  }
	  */
	  #my-video, #videosrc {
		max-width: 100vw;
		padding: 0;
		margin: 0;
	  }

	/*audio::-webkit-media-controls,
	video::-webkit-media-controls {
		display: none;
	}
	
	audio::-webkit-media-controls-timeline,
	video::-webkit-media-controls-timeline {
		display: block;
	}*/

    </style>
  </head>
  <body style="text-align: center">
    <canvas id="unity-canvas" style="background: url('Build/a4378e2f7373bd6d0cccd1f09de8f184.jpg') center / cover"></canvas>
	<div id="video_player_box">
		<figure>
			<video id="my-video" playsinline autoplay onclick="playVideo()" poster="./bookr-class-logo-with-bg.jpg">
				<source id="videosrc" src="https://bkrapi-win.v2.bookrclass.com/convertedBooks/ID97_20211112130024.mp4" type="video/mp4" />
					To view this video please enable JavaScript, and consider upgrading to a
					web browser that
			</video>
			<!-- CODE FOR CUSTOM PROGRESS BAR - Pls don't delete it, because customer asked for this, but then he changed his mind - Maybe it will be useful again in the future!
			<!--figcaption>
				<progress id="progress" max="100" value="0">Progress</progress>
			</figcaption-->
		</figure>
		<!-- Custom Play Button - Don't delete it - Customer asked for this but then changed his mind -->
		<!--div id="video_controls_bar" style="opacity: 0">
			<!--img id="playpausebtn" onclick="playPause(this,'my-video')" src="white-play-icon-png-4.jpg"/-->
			<!--img id="playpausebtn" onclick="playPause(this,'my-video')"/-->
		<!--/div-->
	</div>
	<!-- Original video tag and content was: -->
    <!--video id="my-video" controls >
      <source id="videosrc" src="https://bkrapi-win.v2.bookrclass.com/convertedBooks/ID97_20211112130024.mp4" type="video/mp4" />
        To view this video please enable JavaScript, and consider upgrading to a
        web browser that
    </video-->
    <ul id="book-list"></ul>
    <script src="Build/25fa751264f29618c1b864e61a38990f.js"></script>
    <script src="./booklist.js"></script>
    <script>
      !function(a){var b=/iPhone/i,c=/iPod/i,d=/iPad/i,e=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,f=/Android/i,g=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,h=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,i=/IEMobile/i,j=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,k=/BlackBerry/i,l=/BB10/i,m=/Opera Mini/i,n=/(CriOS|Chrome)(?=.*\bMobile\b)/i,o=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,p=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),q=function(a,b){return a.test(b)},r=function(a){var r=a||navigator.userAgent,s=r.split("[FBAN");return"undefined"!=typeof s[1]&&(r=s[0]),s=r.split("Twitter"),"undefined"!=typeof s[1]&&(r=s[0]),this.apple={phone:q(b,r),ipod:q(c,r),tablet:!q(b,r)&&q(d,r),device:q(b,r)||q(c,r)||q(d,r)},this.amazon={phone:q(g,r),tablet:!q(g,r)&&q(h,r),device:q(g,r)||q(h,r)},this.android={phone:q(g,r)||q(e,r),tablet:!q(g,r)&&!q(e,r)&&(q(h,r)||q(f,r)),device:q(g,r)||q(h,r)||q(e,r)||q(f,r)},this.windows={phone:q(i,r),tablet:q(j,r),device:q(i,r)||q(j,r)},this.other={blackberry:q(k,r),blackberry10:q(l,r),opera:q(m,r),firefox:q(o,r),chrome:q(n,r),device:q(k,r)||q(l,r)||q(m,r)||q(o,r)||q(n,r)},this.seven_inch=q(p,r),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0},s=function(){var a=new r;return a.Class=r,a};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=r:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=s():"function"==typeof define&&define.amd?define("isMobile",[],a.isMobile=s()):a.isMobile=s()}(this);
      
      function playVideo() {
      document.getElementById("my-video").play();
      }
      
      function playPause(btn,vid){
        var vid = document.getElementById(vid);
        if(vid.paused){
          vid.play();
          /*btn.innerHTML = "Pause";				*/
          btn.remove();
        } /*else {
          vid.pause();
          btn.innerHTML = "Play";
        }*/
      }
      
      let isIPad = navigator.maxTouchPoints && navigator.maxTouchPoints > 2 && /MacIntel/.test(navigator.platform);
      if (isMobile.any || isIPad) {
          var myVideo = document.getElementById("videosrc");
          const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
          });
          var src = "";
          var posterImg = "https://api.v2.bookrclass.com/api/media/Ym9vay1jb3Zlci93LzMvdzNsa3p5ZzFZYW1pQjlxVXJMYU1vSFZseDU1UXJUeGhVT1VvbkVQWUs0LmpwZw==/original_4k.jpg";
          var documentBookList = document.getElementById("book-list");
          for (var id in bookList) {
            var book = bookList[id];

            const li = document.createElement('li');
            li.innerHTML = `<h3><a href="?book=`+book.id+`">`+book.name+`</a></h3>`;
            document.getElementById('content').appendChild(li);

            if (book.id == params.book) {
              src = book.src;
              posterImg = book.posterImg;
            }
          }
          myVideo.src = src;
          document.getElementById("my-video").load();
          document.getElementById('my-video').addEventListener('ended',myEndHandler,false);
          document.getElementById('my-video').addEventListener('pause',myEndHandler,false);
          document.getElementById('my-video').addEventListener('play',myStartHandler,false);
		  
		  /* Custom Progressbar - Don't delete it, maybe it can be useful later again - Client asked for it, then changed his mind!
		  document.getElementById("my-video").addEventListener("timeupdate", function() {
			   // if the video is loaded and duration is known
			   if(!isNaN(this.duration)) {
					var percent_complete = Math.round((this.currentTime / this.duration) * 100);
					// use percent_complete to draw a progress bar
					document.getElementById("progress").value = percent_complete;
				}
			});
			*/
		  
		  document.getElementById("my-video").setAttribute("poster",posterImg);
          var started = new Date();
          function myStartHandler(e) {
            started = new Date();
          }
          function myEndHandler(e) {
              var ended = new Date();
              var distance = (ended.getTime() - started.getTime()) / 1000;
              const params = new Proxy(new URLSearchParams(window.location.search), {
                get: (searchParams, prop) => searchParams.get(prop),
              });
              var result = {
                  bookId: params.book,
                  userId: null,
                  startedAt: started,
                  duration: distance,
                  pagesVisited: [],
                  lastPageVisited: 0,
              };
              var resultJson = JSON.stringify(result)
              console.log(resultJson)
              window.top.postMessage(resultJson, '*');
          }

          var myobj = document.getElementById("unity-canvas");
          myobj.remove();
          if (src === "") {
            let myobj2 = document.getElementById("video_player_box");
            myobj2.remove();
          } else {
            let myobj3 = document.getElementById("book-list");
            myobj3.remove();
          }
      } else {
          var myobj = document.getElementById("video_player_box");
          myobj.remove();
          let myobj2 = document.getElementById("book-list");
          myobj2.remove();

          createUnityInstance(document.querySelector("#unity-canvas"), {
            dataUrl: "Build/24dfb5ad7b23d8291d0e27f3a0a58aeb.data.unityweb",
            frameworkUrl: "Build/437920acffb9acf11d6816baa03ad63f.js.unityweb",
            codeUrl: "Build/de7d6755810b5830b63f2a7f58af8397.wasm.unityweb",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "Bookr",
            productName: "Webapp",
            productVersion: "1.0.2",
          });
      }
    </script>
  </body>
</html>
